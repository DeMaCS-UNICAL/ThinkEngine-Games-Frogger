setOnActuator(playerAct(player(player(execute(X))))):-
setOnActuator(playerAct(player(player(answerA(X))))):-
setOnActuator(playerAct(player(player(answerB(X))))):-
%trunkLine1(trunkSpawnerLine1(trunkSpawner(spawnedComponents(X,trunk(posX(V)))))).
%trunkLine1(trunkSpawnerLine1(trunkSpawner(spawnedComponents(X,trunk(posZ(V)))))).
%trunkLine1(trunkSpawnerLine1(trunkSpawner(spawnedComponents(X,trunk(dim(V)))))).
%trunkLine2(trunkSpawnerLine2(trunkSpawner(spawnedComponents(X,trunk(posX(V)))))).
%trunkLine2(trunkSpawnerLine2(trunkSpawner(spawnedComponents(X,trunk(posZ(V)))))).
%trunkLine2(trunkSpawnerLine2(trunkSpawner(spawnedComponents(X,trunk(dim(V)))))).
%trunkLine3(trunkSpawnerLine3(trunkSpawner(spawnedComponents(X,trunk(posX(V)))))).
%trunkLine3(trunkSpawnerLine3(trunkSpawner(spawnedComponents(X,trunk(posZ(V)))))).
%trunkLine3(trunkSpawnerLine3(trunkSpawner(spawnedComponents(X,trunk(dim(V)))))).
%turtleLine1(tSpawnerLine1(turtleSpawner(spawnedComponents(X,turtle(posX(V)))))).
%turtleLine1(tSpawnerLine1(turtleSpawner(spawnedComponents(X,turtle(posZ(V)))))).
%turtleLine2(tSpawnerLine2(turtleSpawner(spawnedComponents(X,turtle(posX(V)))))).
%turtleLine2(tSpawnerLine2(turtleSpawner(spawnedComponents(X,turtle(posZ(V)))))).
%lineCars1(lineCars1(scrollLine(dir(value(X))))).
%lineCars1(lineCars1(scrollLine(carComponents(X,car(posX(V)))))).
%lineCars1(lineCars1(scrollLine(carComponents(X,car(posZ(V)))))).
%lineCars2(lineCars2(scrollLine(dir(value(X))))).
%lineCars2(lineCars2(scrollLine(carComponents(X,car(posX(V)))))).
%lineCars2(lineCars2(scrollLine(carComponents(X,car(posZ(V)))))).
%lineCars3(lineCars3(scrollLine(dir(value(X))))).
%lineCars3(lineCars3(scrollLine(carComponents(X,car(posX(V)))))).
%lineCars3(lineCars3(scrollLine(carComponents(X,car(posZ(V)))))).
%lineCars4(lineCars4(scrollLine(dir(value(X))))).
%lineCars4(lineCars4(scrollLine(carComponents(X,car(posX(V)))))).
%lineCars4(lineCars4(scrollLine(carComponents(X,car(posZ(V)))))).
%lineSuperCar(lineSuperCar(scrollLine(dir(value(X))))).
%lineSuperCar(lineSuperCar(scrollLine(carComponents(X,car(posX(V)))))).
%lineSuperCar(lineSuperCar(scrollLine(carComponents(X,car(posZ(V)))))).
%playerSensor(player(player(posX(X)))).
%playerSensor(player(player(posZ(X)))).
%goal1(goal1(goal(empty(X)))).
%goal1(goal1(goal(posX(X)))).
%goal1(goal1(goal(posZ(X)))).
%goal2(goal2(goal(empty(X)))).
%goal2(goal2(goal(posX(X)))).
%goal2(goal2(goal(posZ(X)))).
%goal3(goal3(goal(empty(X)))).
%goal3(goal3(goal(posX(X)))).
%goal3(goal3(goal(posZ(X)))).
%goal4(goal4(goal(empty(X)))).
%goal4(goal4(goal(posX(X)))).
%goal4(goal4(goal(posZ(X)))).
%goal5(goal5(goal(empty(X)))).
%goal5(goal5(goal(posX(X)))).
%goal5(goal5(goal(posZ(X)))).







%trunkLine1(trunkSpawnerLine1(trunkSpawner(spawnedComponents(X,trunk(posX(V)))))).
%trunkLine1(trunkSpawnerLine1(trunkSpawner(spawnedComponents(X,trunk(posZ(V)))))).
%trunkLine1(trunkSpawnerLine1(trunkSpawner(spawnedComponents(X,trunk(dim(V)))))).
%trunkLine2(trunkSpawnerLine2(trunkSpawner(spawnedComponents(X,trunk(posX(V)))))).
%trunkLine2(trunkSpawnerLine2(trunkSpawner(spawnedComponents(X,trunk(posZ(V)))))).
%trunkLine2(trunkSpawnerLine2(trunkSpawner(spawnedComponents(X,trunk(dim(V)))))).
%trunkLine3(trunkSpawnerLine3(trunkSpawner(spawnedComponents(X,trunk(posX(V)))))).
%trunkLine3(trunkSpawnerLine3(trunkSpawner(spawnedComponents(X,trunk(posZ(V)))))).
%trunkLine3(trunkSpawnerLine3(trunkSpawner(spawnedComponents(X,trunk(dim(V)))))).
%turtleLine1(tSpawnerLine1(turtleSpawner(spawnedComponents(X,turtle(posX(V)))))).
%turtleLine1(tSpawnerLine1(turtleSpawner(spawnedComponents(X,turtle(posZ(V)))))).
%turtleLine2(tSpawnerLine2(turtleSpawner(spawnedComponents(X,turtle(posX(V)))))).
%turtleLine2(tSpawnerLine2(turtleSpawner(spawnedComponents(X,turtle(posZ(V)))))).
%lineCars1(lineCars1(scrollLine(dir(value(X))))).
%lineCars1(lineCars1(scrollLine(carComponents(X,car(posX(V)))))).
%lineCars1(lineCars1(scrollLine(carComponents(X,car(posZ(V)))))).
%lineCars2(lineCars2(scrollLine(dir(value(X))))).
%lineCars2(lineCars2(scrollLine(carComponents(X,car(posX(V)))))).
%lineCars2(lineCars2(scrollLine(carComponents(X,car(posZ(V)))))).
%lineCars3(lineCars3(scrollLine(dir(value(X))))).
%lineCars3(lineCars3(scrollLine(carComponents(X,car(posX(V)))))).
%lineCars3(lineCars3(scrollLine(carComponents(X,car(posZ(V)))))).
%lineCars4(lineCars4(scrollLine(dir(value(X))))).
%lineCars4(lineCars4(scrollLine(carComponents(X,car(posX(V)))))).
%lineCars4(lineCars4(scrollLine(carComponents(X,car(posZ(V)))))).
%lineSuperCar(lineSuperCar(scrollLine(dir(value(X))))).
%lineSuperCar(lineSuperCar(scrollLine(carComponents(X,car(posX(V)))))).
%lineSuperCar(lineSuperCar(scrollLine(carComponents(X,car(posZ(V)))))).
%goal(goal2(transform(position(x(X))))).
%goal(goal2(transform(position(z(X))))).
%goal(goal2(goal(empty(X)))).
%playerSensor(player(player(posX(X)))).
%playerSensor(player(player(posZ(X)))).

setOnActuator(playerAct(player(player(answerA(X))))):-fullAnswer(X,Ss,_,_).
setOnActuator(playerAct(player(player(answerB(X))))):-fullAnswer(Fs,X,_,_).
%setOnActuator(playerAct(player(player(answerC(X))))):-




%FattiNoti
firstStep(0)
secondStep(1)
xCoord(0..19).
maxXCoord(19).
maxZCoord(12).
zCoord(0..12).
moveTo(still).
moveTo(up).
moveTo(left).
moveTo(right).
moveTo(down).

%Reorganized Data From Sensors
trunkRaw(X,Z,Dim):- trunkLine1(trunkSpawnerLine1(trunkSpawner(spawnedComponents(T,trunk(posX(X)))))),trunkLine1(trunkSpawnerLine1(trunkSpawner(spawnedComponents(T,trunk(posZ(Z)))))),trunkLine1(trunkSpawnerLine1(trunkSpawner(spawnedComponents(T,trunk(dim(Dim)))))).
trunkRaw(X,Z,Dim):- trunkLine1(trunkSpawnerLine2(trunkSpawner(spawnedComponents(T,trunk(posX(X)))))),trunkLine2(trunkSpawnerLine1(trunkSpawner(spawnedComponents(T,trunk(posZ(Z)))))),trunkLine2(trunkSpawnerLine1(trunkSpawner(spawnedComponents(T,trunk(dim(Dim)))))).
trunkRaw(X,Z,Dim):- trunkLine1(trunkSpawnerLine3(trunkSpawner(spawnedComponents(T,trunk(posX(X)))))),trunkLine3(trunkSpawnerLine1(trunkSpawner(spawnedComponents(T,trunk(posZ(Z)))))),trunkLine3(trunkSpawnerLine1(trunkSpawner(spawnedComponents(T,trunk(dim(Dim)))))).
trunk(X,Z):-trunkRaw(X,Z,1).
trunk(X,Z):-trunkRaw(X,Z,3).
trunk(X,Z):-trunkRaw(X1,Z,3),X=X1+1.
trunk(X,Z):-trunkRaw(X1,Z,3),X=X1-1.
trunk(X,Z):-trunkRaw(X,Z,5).
trunk(X,Z):-trunkRaw(X1,Z,5),X=X1+1.
trunk(X,Z):-trunkRaw(X1,Z,5),X=X1-1.
trunk(X,Z):-trunkRaw(X1,Z,5),X=X1+2.
trunk(X,Z):-trunkRaw(X1,Z,5),X=X1-2.

turtle(X,Z):- turtleLine1(tSpawnerLine1(turtleSpawner(spawnedComponents(T,turtle(posX(X)))))), turtleLine1(tSpawnerLine1(turtleSpawner(spawnedComponents(T,turtle(posZ(Z)))))).
turtle(X,Z):- turtleLine2(tSpawnerLine1(turtleSpawner(spawnedComponents(T,turtle(posX(X)))))), turtleLine2(tSpawnerLine1(turtleSpawner(spawnedComponents(T,turtle(posZ(Z)))))).

car(X,Z,Dir):- lineCars1(lineCars1(scrollLine(carComponents(T,car(posX(X)))))),lineCars1(lineCars1(scrollLine(carComponents(T,car(posZ(Z)))))),lineCars1(lineCars1(scrollLine(dir(value(Dir))))).
car(X,Z,Dir):- lineCars2(lineCars2(scrollLine(carComponents(T,car(posX(X)))))),lineCars2(lineCars2(scrollLine(carComponents(T,car(posZ(Z)))))),lineCars2(lineCars2(scrollLine(dir(value(Dir))))).
car(X,Z,Dir):- lineCars3(lineCars3(scrollLine(carComponents(T,car(posX(X)))))),lineCars3(lineCars3(scrollLine(carComponents(T,car(posZ(Z)))))),lineCars3(lineCars3(scrollLine(dir(value(Dir))))).
car(X,Z,Dir):- lineCars4(lineCars4(scrollLine(carComponents(T,car(posX(X)))))),lineCars4(lineCars4(scrollLine(carComponents(T,car(posZ(Z)))))),lineCars4(lineCars4(scrollLine(dir(value(Dir))))).
car(X,Z,Dir):- lineSuperCar(lineSuperCar(scrollLine(carComponents(T,car(posX(X)))))),lineSuperCar(lineSuperCar(scrollLine(carComponents(T,car(posZ(Z)))))),lineSuperCar(lineSuperCar(scrollLine(dir(value(Dir))))).

goal(X,Z,Avaible):- goal1(goal1(goal(posX(X)))),goal1(goal1(goal(posZ(Z)))),goal1(goal1(goal(empty(Avaible)))).
goal(X,Z,Avaible):- goal2(goal2(goal(posX(X)))),goal2(goal2(goal(posZ(Z)))),goal2(goal2(goal(empty(Avaible)))).
goal(X,Z,Avaible):- goal3(goal3(goal(posX(X)))),goal3(goal3(goal(posZ(Z)))),goal3(goal3(goal(empty(Avaible)))).
goal(X,Z,Avaible):- goal4(goal4(goal(posX(X)))),goal4(goal4(goal(posZ(Z)))),goal4(goal4(goal(empty(Avaible)))).
goal(X,Z,Avaible):- goal5(goal5(goal(posX(X)))),goal5(goal5(goal(posZ(Z)))),goal5(goal5(goal(empty(Avaible)))).

%Posizioni non sicure perché occupate dalle macchine, o non presente tartaruga o tronco
unsafe(X,Z):- car(X,Z,_),xCoord(X),zCoord(Z).
unsafe(X,Z):- car(X1,Z,1),xCoord(X),zCoord(Z),X=X1+1.
unsafe(X,Z):- car(X1,Z,-1),xCoord(X),zCoord(Z),X=X1-1.
unsafe(X,Z):-not safe(X,Z),xCoord(X),zCoord(Z),Z>6. %Tutte le tile che non sono tronchi o tartarughe

nextUnsafe(X,Z):- car(X1,Z,D),xCoord(X),zCoord(Z),X=X1+D.
nextUnsafe(X,Z):- car(X1,Z,1),xCoord(X),zCoord(Z),X=X1+2.
nextUnsafe(X,Z):- car(X1,Z,-1),xCoord(X),zCoord(Z),X=X1-2.
nextUnsafe(X,Z):-not nextSafe(X,Z),xCoord(X),zCoord(Z),Z>6. %Tutte le tile che non sono tronchi o tartarughe


%Posizioni sicure perchè erba o tronco, tartaruga, goal
safe(T,X,Z):- xCoord(X),firstStep(T), Z=0.
safe(T,X,Z):- xCoord(X),firstStep(T) Z=6.
safe(T,X,Z):- trunk(X,Z),firstStep(T)xCoord(X),zCoord(Z).
safe(T,X,Z):- turtle(X,Z),firstStep(T)xCoord(X),zCoord(Z).
safe(T,X,Z):- goal(X,Z,true)firstStep(T).
safe(T,X,Z):-not unsafe(T,X,Z),xCoord(X),zCoord(Z),firstStep(T),Z<6. % Tutte le tile che non sono macchine



safe(T,X,Z):- xCoord(X),secondStep(T) Z=0.
safe(T,X,Z):- xCoord(X),secondStep(T) Z=6.
safe(T,X,Z):-trunk(X1,Z),xCoord(X1),zCoord(Z),secondStep(T),X=X1+1.
safe(T,X,Z):- turtle(X1,Z),xCoord(X1),zCoord(Z),secondStep(T),X=X1-1.
safe(T,X,Z):- goal(X,Z,true),secondStep(T).
safe(T,X,Z):-not unsafe(T1,X,Z),xCoord(X),zCoord(Z),secondStep(T),Z<6). % Tutte le tile che non sono macchine


nextSafe(X,Z):- xCoord(X), Z=0.
nextSafe(X,Z):- xCoord(X), Z=6.
nextSafe(X,Z):-trunk(X1,Z),xCoord(X1),zCoord(Z),X=X1+1.
nextSafe(X,Z):- turtle(X1,Z),xCoord(X1),zCoord(Z),X=X1-1.
nextSafe(X,Z):- goal(X,Z,true).
nextSafe(X,Z):-not nextUnsafe(X,Z),xCoord(X),zCoord(Z),Z<6. % Tutte le tile che non sono macchine


%Posizione Player
playerPos(X,Z):- playerSensor(player(player(posX(X)))),playerSensor(player(player(posZ(Z)))).


%RapportoMoveToDirezioneAuto
%:-moveTo(right), playerPos(X,Z), car(X1,Z,1), X1=X+1.
%:-moveTo(left), playerPos(X,Z), car(X1,Z,-1), X1=X-1.

Answer(Fs,Ss) | NotAnswer(Fs,Ss) :-next2PlayerPos(Fs,_,_,Ss).

%UNIRE I PREDICATI PER LE MOSSE CON UN UNICO ATTRIBUTO
nextPlayerPos(T,X,Z,still):-playerPos(X,Z)T=1.
nextPlayerPos(T,X,Z1,up):-playerPos(X,Z), Z1=Z+1.
nextPlayerPos(T,X,Z1,down):-playerPos(X,Z), Z1=Z-1.
nextPlayerPos(T,X1,Z,left):-playerPos(X,Z), X1=X-1.
nextPlayerPos(T,X1,Z,right):-playerPos(X,Z), X1=X+1.
next2PlayerPos(M,X,Z,still):-nextPlayerPos(X,Z,M).
next2PlayerPos(M,X,Z1,up):-nextPlayerPos(X,Z,M), Z1=Z+1,M!=down.
next2PlayerPos(M,X,Z1,down):-nextPlayerPos(X,Z,M), Z1=Z-1, M!=up.
next2PlayerPos(M,X1,Z,left):-nextPlayerPos(X,Z,M), X1=X-1,M!=right.
next2PlayerPos(M,X1,Z,right):-nextPlayerPos(X,Z,M), X1=X+1, M!=left.




% PlayerPosAfterMove
nextPlayerPos(X,Z,still):-playerPos(X,Z).
nextPlayerPos(X,Z1,up):-playerPos(X,Z), Z1=Z+1.
nextPlayerPos(X,Z1,down):-playerPos(X,Z), Z1=Z-1.
nextPlayerPos(X1,Z,left):-playerPos(X,Z), X1=X-1.
nextPlayerPos(X1,Z,right):-playerPos(X,Z), X1=X+1.
next2PlayerPos(M,X,Z,still):-nextPlayerPos(X,Z,M).
next2PlayerPos(M,X,Z1,up):-nextPlayerPos(X,Z,M), Z1=Z+1,M!=down.
next2PlayerPos(M,X,Z1,down):-nextPlayerPos(X,Z,M), Z1=Z-1, M!=up.
next2PlayerPos(M,X1,Z,left):-nextPlayerPos(X,Z,M), X1=X-1,M!=right.
next2PlayerPos(M,X1,Z,right):-nextPlayerPos(X,Z,M), X1=X+1, M!=left.
:-Answer(M,_), nextPlayerPos(X,Z,M), not safe(X,Z).
:-Answer(M1,M), next2PlayerPos(M1,X,Z,M),not nextSafe(X,Z).

fullAnswer(Fs,Ss,X,Z):- Answer(Fs,Ss),next2PlayerPos(Fs,X,Z,Ss).

